{"ast":null,"code":"import \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport axios from 'axios';\nimport moment from 'moment';\nimport Cookies from 'universal-cookie';\nimport { baseUrl } from '../../config';\nimport alertConstant from '../constants/alert.json';\nimport { refreshTokenTime, loginMaxAge } from '../constants/auth.json';\nconst AxiosInstanceOne = axios.create();\nconst AxiosInstanceTwo = axios.create();\nconst cookies = new Cookies();\nconst getRefreshToken = async axiosOption => {\n  var _cookies$get, _cookies$get2;\n  const token = (_cookies$get = cookies.get('loginDetails')) === null || _cookies$get === void 0 ? void 0 : _cookies$get.token;\n  const refreshToken = (_cookies$get2 = cookies.get('loginDetails')) === null || _cookies$get2 === void 0 ? void 0 : _cookies$get2.refreshToken;\n  const newAxiosOption = {\n    ...axiosOption,\n    data: {\n      token,\n      refreshToken\n    },\n    url: `${baseUrl}authenticate/refresh-token`,\n    method: 'POST'\n  };\n  return new Promise(resolve => {\n    AxiosInstanceOne(newAxiosOption).then(response => {\n      resolve(response);\n    }).catch(error => {\n      if (error.response) {\n        var _error$response, _error$response$data;\n        const errorMsg = error === null || error === void 0 ? void 0 : (_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message;\n        _message.error({\n          content: errorMsg || alertConstant.server_error,\n          style: {\n            marginTop: '2vh'\n          },\n          key: 'updatable'\n        });\n      } else {\n        _message.error({\n          content: alertConstant.server_error,\n          style: {\n            marginTop: '2vh'\n          },\n          key: 'updatable'\n        });\n      }\n      resolve(true);\n    });\n  });\n};\nexport const apiCall = (endPoint, methodType, data) => {\n  var _cookies$get3;\n  let token = (_cookies$get3 = cookies.get('loginDetails')) === null || _cookies$get3 === void 0 ? void 0 : _cookies$get3.token;\n  const axiosOption = {\n    headers: {\n      'Content-Type': 'application/json',\n      Authorization: `Bearer ${token}`\n    },\n    url: `${baseUrl}${endPoint}`,\n    method: methodType,\n    timeout: 120000,\n    data\n  };\n  AxiosInstanceTwo.interceptors.request.use(async config => {\n    const loginDetails = cookies.get('loginDetails');\n    const expireAt = loginDetails === null || loginDetails === void 0 ? void 0 : loginDetails.expireAt;\n    const isSessionLoggedIn = loginDetails === null || loginDetails === void 0 ? void 0 : loginDetails.sessionLogin;\n    if (moment().isAfter(moment(expireAt))) {\n      var _newTokenDetail$data, _newTokenDetail$data2;\n      const newTokenDetail = await getRefreshToken(axiosOption);\n      const newToken = newTokenDetail === null || newTokenDetail === void 0 ? void 0 : (_newTokenDetail$data = newTokenDetail.data) === null || _newTokenDetail$data === void 0 ? void 0 : _newTokenDetail$data.token;\n      const newRefreshToken = newTokenDetail === null || newTokenDetail === void 0 ? void 0 : (_newTokenDetail$data2 = newTokenDetail.data) === null || _newTokenDetail$data2 === void 0 ? void 0 : _newTokenDetail$data2.refreshToken;\n      if (newToken && newRefreshToken) {\n        var _newTokenDetail$data3;\n        token = newTokenDetail === null || newTokenDetail === void 0 ? void 0 : (_newTokenDetail$data3 = newTokenDetail.data) === null || _newTokenDetail$data3 === void 0 ? void 0 : _newTokenDetail$data3.token;\n        cookies.set('loginDetails', {\n          ...loginDetails,\n          token: newToken,\n          refreshToken: newRefreshToken,\n          expireAt: moment(Date.now()).add(refreshTokenTime, 'minute').format('YYYY-MM-DDTHH:mm:ssZz')\n        }, isSessionLoggedIn ? {\n          path: '/'\n        } : {\n          path: '/',\n          maxAge: loginMaxAge\n        });\n      }\n    }\n    return config;\n  }, () => {\n    _message.error({\n      content: alertConstant.authentication_error,\n      style: {\n        marginTop: '2vh'\n      },\n      key: 'updatable'\n    });\n  });\n  return new Promise(resolve => {\n    AxiosInstanceTwo({\n      ...axiosOption,\n      headers: {\n        'Content-Type': 'application/json',\n        Authorization: `Bearer ${token}`\n      }\n    }).then(response => {\n      resolve(response);\n    }).catch(error => {\n      if (error.response) {\n        var _error$response2, _error$response2$data, _error$response2$data2, _error$response3, _error$response3$data;\n        const errorMsg = error === null || error === void 0 ? void 0 : (_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : (_error$response2$data2 = _error$response2$data.errors) === null || _error$response2$data2 === void 0 ? void 0 : _error$response2$data2[0];\n        const errorMsg2 = error === null || error === void 0 ? void 0 : (_error$response3 = error.response) === null || _error$response3 === void 0 ? void 0 : (_error$response3$data = _error$response3.data) === null || _error$response3$data === void 0 ? void 0 : _error$response3$data.message;\n        _message.error({\n          content: errorMsg || errorMsg2 || alertConstant.server_error,\n          style: {\n            marginTop: '2vh'\n          },\n          key: 'updatable'\n        });\n      } else {\n        _message.error({\n          content: alertConstant.server_error,\n          style: {\n            marginTop: '2vh'\n          },\n          key: 'updatable'\n        });\n      }\n      resolve(error === null || error === void 0 ? void 0 : error.response);\n    });\n  });\n};","map":{"version":3,"names":["axios","moment","Cookies","baseUrl","alertConstant","refreshTokenTime","loginMaxAge","AxiosInstanceOne","create","AxiosInstanceTwo","cookies","getRefreshToken","axiosOption","token","get","refreshToken","newAxiosOption","data","url","method","Promise","resolve","then","response","catch","error","errorMsg","message","content","server_error","style","marginTop","key","apiCall","endPoint","methodType","headers","Authorization","timeout","interceptors","request","use","config","loginDetails","expireAt","isSessionLoggedIn","sessionLogin","isAfter","newTokenDetail","newToken","newRefreshToken","set","Date","now","add","format","path","maxAge","authentication_error","errors","errorMsg2"],"sources":["/Users/zhaoke/Desktop/TYR/TYR.WEB.CLIENT/src/shared/api/apiWrapper.ts"],"sourcesContent":["import axios from 'axios';\nimport { message } from 'antd';\nimport moment from 'moment';\nimport Cookies from 'universal-cookie';\nimport { baseUrl } from '../../config';\nimport alertConstant from '../constants/alert.json';\nimport { refreshTokenTime, loginMaxAge } from '../constants/auth.json';\n\nconst AxiosInstanceOne = axios.create();\nconst AxiosInstanceTwo = axios.create();\nconst cookies = new Cookies();\n\nconst getRefreshToken = async (axiosOption: any) => {\n  const token = cookies.get('loginDetails')?.token;\n  const refreshToken = cookies.get('loginDetails')?.refreshToken;\n  const newAxiosOption = {\n    ...axiosOption,\n    data: { token, refreshToken },\n    url: `${baseUrl}authenticate/refresh-token`,\n    method: 'POST',\n  };\n  return new Promise((resolve) => {\n    AxiosInstanceOne(newAxiosOption)\n      .then((response) => {\n        resolve(response);\n      })\n      .catch((error) => {\n        if (error.response) {\n          const errorMsg = error?.response?.data?.message;\n          message.error({\n            content: (errorMsg || alertConstant.server_error),\n            style: {\n              marginTop: '2vh',\n            },\n            key: 'updatable',\n          });\n        } else {\n          message.error({\n            content: alertConstant.server_error,\n            style: {\n              marginTop: '2vh',\n            },\n            key: 'updatable',\n          });\n        }\n        resolve(true);\n      });\n  });\n};\n\nexport const apiCall = (endPoint: string, methodType: any, data: any) => {\n  let token = cookies.get('loginDetails')?.token;\n\n  const axiosOption = {\n    headers: {\n      'Content-Type': 'application/json',\n      Authorization: `Bearer ${token}`,\n    },\n    url: `${baseUrl}${endPoint}`,\n    method: methodType,\n    timeout: 120000,\n    data,\n  };\n\n  AxiosInstanceTwo.interceptors.request.use(async (config) => {\n    const loginDetails = cookies.get('loginDetails');\n    const expireAt = loginDetails?.expireAt;\n    const isSessionLoggedIn = loginDetails?.sessionLogin;\n    if (moment().isAfter(moment(expireAt))) {\n      const newTokenDetail: any = await getRefreshToken(axiosOption);\n      const newToken = newTokenDetail?.data?.token;\n      const newRefreshToken = newTokenDetail?.data?.refreshToken;\n\n      if (newToken && newRefreshToken) {\n        token = newTokenDetail?.data?.token;\n        cookies.set('loginDetails', {\n          ...loginDetails,\n          token: newToken,\n          refreshToken: newRefreshToken,\n          expireAt: moment(Date.now()).add(refreshTokenTime, 'minute').format('YYYY-MM-DDTHH:mm:ssZz'),\n        }, isSessionLoggedIn ? { path: '/' } : { path: '/', maxAge: loginMaxAge });\n      }\n    }\n    return config;\n  }, () => {\n    message.error({\n      content: alertConstant.authentication_error,\n      style: {\n        marginTop: '2vh',\n      },\n      key: 'updatable',\n    });\n  });\n\n  return new Promise((resolve) => {\n    AxiosInstanceTwo({\n      ...axiosOption,\n      headers: {\n        'Content-Type': 'application/json',\n        Authorization: `Bearer ${token}`,\n      },\n    })\n      .then((response) => {\n        resolve(response);\n      })\n      .catch((error) => {\n        if (error.response) {\n          const errorMsg = error?.response?.data?.errors?.[0];\n          const errorMsg2 = error?.response?.data?.message;\n          message.error({\n            content: (errorMsg || errorMsg2 || alertConstant.server_error),\n            style: {\n              marginTop: '2vh',\n            },\n            key: 'updatable',\n          });\n        } else {\n          message.error({\n            content: alertConstant.server_error,\n            style: {\n              marginTop: '2vh',\n            },\n            key: 'updatable',\n          });\n        }\n        resolve(error?.response);\n      });\n  });\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}